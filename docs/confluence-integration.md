# Интеграция с Confluence
Confluence используется для формирования ответа на заданный пользователем вопрос и выдачи пользователю справочной информации.

> [!IMPORTANT]
> Выгрузка справочной структуры в чат-бот осуществляется в режиме онлайн с использованием часового кеширования, т.е. структура дерева страниц и информация сохраняются в памяти и не запрашиваются вновь из Confluence, если с момента прошлого запроса прошло менее часа.
> 
> Для ответов на вопросы документы подбираются не напрямую из Confluence, а из отдельной векторной (поисковой) базы данных, синхронизация с Confluence осуществляется 1 раз в сутки в 18:05.

## Требования к пространству на Confluence
Пространство на Confluence содержит страницы, чат-бот повторяет древовидную структуру страниц, настроенную на Confluence. Эта структура предусматривает вложенность страниц (одна страница может содержать ссылки на другие страницы), что используется для навигации в пространстве. 

Страницы в пространстве могут содержать теги:
 * "справка" — страницы с этим тегом будут отображены в кнопках чат-бота;
 * "навигация" — страницы с этим тегом не содержат информацию, полезную для ответов на вопросы, поэтому не учитываются при ответе на вопрос.

> [!IMPORTANT]
> Вложения в виде PDF-файлов должны быть машиночитаемым, т.е. текст из них легко копируется в другие приложения, а не представляет собой "кракозябры".

## Конфигурация подключения к Confluence
Для подключения к Confluence задаются следующие переменные среды:
```
CONFLUENCE_TOKEN= # API-токен
CONFLUENCE_HOST= # URL-адрес вики-системы
CONFLUENCE_SPACES= # разделённые пробелом кодовые названия пространств, в которых хранятся документы для ответов на вопросы, структура первого в списке пространства продублируется в чат-боте
```
Переменные среды подтягиваются в файлах `config.py` и располагаются в классе `Config`. Файлы `config.py` содержатся в модулях `qa` и `chatbot`.
